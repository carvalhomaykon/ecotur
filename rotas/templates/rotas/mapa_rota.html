{% load static %}

{% include "global/partials/_header.html" %}

    <section>
        <h1>Mapa de Rota Turística</h1>
        <div id="map">
            <script>
                // Inicializa o mapa e define a localização inicial
                const map = L.map('map').setView([-1.457953, -48.478489], 13); // Coordenadas de Belém, PA

                // Adiciona a camada do OpenStreetMap
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);

                // Lista de pontos turísticos
                const pontosTuristicos = [
                    {% if pontos_completos %}
                        {% for ponto in pontos_completos %}
                            {
                                nome: "{{ ponto.nome }}", 
                                coords: {{ ponto.coords }}, 
                                descricao: "{{ ponto.descricao }}"
                            }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    {% else %}
                        console.error("Nenhum ponto encontrado.");
                    {% endif %}
                ];

                // Adiciona os marcadores no mapa
                pontosTuristicos.forEach(ponto => {
                    const marker = L.marker(ponto.coords).addTo(map);
                    // Adiciona um popup ao marcador
                    marker.bindPopup(`
                        <h3>${ponto.nome}</h3>
                        <p>${ponto.descricao}</p>
                        <img src="${ponto.imagem}" alt="Imagem ${ponto.nome}" style="width: 100px; height: auto;">
                    `);
                });

            </script>
        </div>

        <div class="filtros">
            <div class="filtro-div">
                <select name="filtros" id="filtros">
                    <option value="belem">Belém</option>
                    <option value="ananindeua">Ananindeua</option>
                    <option value="marituba">Marituba</option>
                </select>
            </div>

            <div class="filtros">
                <details>
                    <summary>Filtros</summary>
            
                    <!-- Filtro de Tempo -->
                    <div class="filtro-item">
                        <label for="tempo">Tempo</label>
                        <select name="tempo" id="tempo">
                            <option value="todos">Todos</option>
                            <option value="tempo-curto">Curto</option>
                            <option value="tempo-médio">Médio</option>
                            <option value="tempo-longo">Longo</option>
                        </select>
                    </div>
            
                    <!-- Filtro de Distância -->
                    <div class="filtro-item">
                        <label for="distancia">Distância</label>
                        <select name="distancia" id="distancia">
                            <option value="todos">Todos</option>
                            <option value="curta">Curta</option>
                            <option value="media">Média</option>
                            <option value="longa">Longa</option>
                        </select>
                    </div>
            
                    <!-- Filtro de Popularidade -->
                    <div class="filtro-item">
                        <label for="popularidade">Popularidade</label>
                        <select name="popularidade" id="popularidade">
                            <option value="todos">Todos</option>
                            <option value="popular-alta">Alta</option>
                            <option value="popular-moderada">Moderada</option>
                            <option value="popular-baixa">Baixa</option>
                        </select>
                    </div>
            
                    <!-- Filtro de Dificuldade -->
                    <div class="filtro-item">
                        <label for="dificuldade">Dificuldade</label>
                        <select name="dificuldade" id="dificuldade">
                            <option value="todos">Todos</option>
                            <option value="facil">Fácil</option>
                            <option value="moderada">Moderada</option>
                            <option value="dificil">Difícil</option>
                        </select>
                    </div>
                </details>
            </div>
            
            <div class="button-filtrar">
                <button>Filtrar</button>
            </div>
        </div>
        
        <h2>Sugestões:</h2>

        {% if pontos %}
            {% for ponto in pontos %}
                {% include "global/partials/_cards.html" %}
            {% endfor %}
        {% else %}
            <h2>Nenhum ponto encontrado</h2>
        {% endif %}
        

        <div class="button-rota">
            <button onclick="prepararRota()"><a href="{% url 'minha_rota' %}">Gerar Rota</a></button>
        </div>
    </section>

{% include "global/partials/_footer.html" %}

<script>
    function prepararRota() {
        // Recupera a lista de pontos armazenados no localStorage
        const pontosRota = JSON.parse(localStorage.getItem('pontosRota')) || [];

        if (pontosRota.length > 0) {
            alert("Preparando rota...");
            console.log('Gerando rota com os seguintes pontos:', pontosRota);
        } else {
            alert('Nenhum ponto foi selecionado!');
        }
    }
</script>